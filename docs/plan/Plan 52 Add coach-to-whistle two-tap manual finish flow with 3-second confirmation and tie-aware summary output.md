## Task Analysis
- Main objective: Implement a safe manual finish flow on `page/game.js` with a coach-to-whistle two-tap confirmation (3-second timeout), persist a finished match with completed + final partial set context, and render tie-aware summary output on `page/summary.js`.
- Identified dependencies: Existing game finish pipeline (`executeScoringAction` -> `saveCurrentRuntimeState({ force: true })` -> `handleMatchFinishedTransition()`), footer render pattern in `GAME_LAYOUT` + `renderFooterElements`, confirmation/timer UX pattern in `page/history-detail.js` and `page/settings.js`, summary view model in `createSummaryViewModel`, localization files in `page/i18n/*.po`, and test harnesses in `tests/game-screen-layout.test.js` and `tests/summary-screen.test.js`.
- System impact: Medium, because the change touches footer controls, transient page state (timer + confirm mode), finish-state data shape (`status`, `winnerTeam`, `setHistory`), summary winner messaging, and several test assumptions (button count/order currently anchored to 5 controls).

## Chosen Approach
- Proposed solution: Keep changes local to page-level orchestration by adding a manual-finish confirm state machine in `page/game.js` (default coach icon, first tap enters confirm mode + whistle icon + toast + 3s timer, second tap confirms finish), generate a manual-finished runtime snapshot that appends the current set once and resolves winner strictly from `setsWon`, then reuse the existing finish transition path so persistence/history/home-resume behavior stays aligned with automatic scoring completion.
- Justification for simplicity: This avoids overengineering (no new shared confirmation framework, no scoring-engine rewrite), reuses proven page patterns (history-detail/settings timer confirmation), and minimizes regression risk by preserving existing navigation/persistence code paths rather than introducing an alternate finish pipeline.
- Components to be modified/created: `page/game.js` (footer UI + confirm mode/timer + manual finish state builder + cleanup), `page/summary.js` (tie-aware winner text resolution), `page/i18n/en-US.po`, `page/i18n/pt-BR.po`, `page/i18n/es-ES.po` (add `summary.tiedGame`), `tests/game-screen-layout.test.js` (footer/timer/manual-finish assertions + helper updates), `tests/summary-screen.test.js` (tie/winner/set-history assertions), `docs/plan/Plan 52 Add coach-to-whistle two-tap manual finish flow with 3-second confirmation and tie-aware summary output.md` (this plan).

## Implementation Steps
1. Add manual-finish footer control structure in `page/game.js` by extending footer rendering to include two icon buttons (home + confirm-finish), preserving existing home button index/order semantics where possible (`buttons[4]` remains home; new coach icon follows).
2. Implement two-tap confirmation state and timer in `page/game.js`: initialize `manualFinishConfirmMode` and `manualFinishConfirmTimer` in `onInit`, first tap sets confirm mode + shows `hmUI.showToast(...)` + starts 3000ms timer + rerenders whistle icon, second tap within window clears timer and proceeds to finish, timeout auto-resets to coach icon and exits confirm mode.
3. Add robust timer cleanup hooks in `page/game.js`: clear/reset manual finish timer before home navigation, before summary navigation, in RIGHT-gesture back flow, and in `onDestroy`; elevated-risk mitigation: centralize cleanup in one method (e.g., `clearManualFinishConfirmTimer`) to avoid orphan timer callbacks; rollback note: if navigation regressions appear, isolate by temporarily disabling confirm timer rerender path and validating navigation handlers independently.
4. Implement manual finish state capture in `page/game.js` with a pure snapshot helper: clone runtime state, normalize `setsWon`, append current set snapshot (`currentSetStatus.number/teamAGames/teamBGames`) exactly once to `setHistory` (dedupe by set number to prevent duplicate append on repeated triggers), set `status = 'finished'`, compute winner from `setsWon` only (`teamA`, `teamB`, or tie), apply/clear winner metadata accordingly, and execute via `executeScoringAction` so existing persistence + summary navigation pipeline remains unchanged.
5. Update summary tie behavior in `page/summary.js` and localization files: add `summary.tiedGame` to `page/i18n/en-US.po`, `page/i18n/pt-BR.po`, `page/i18n/es-ES.po`; update winner-text selection in `createSummaryViewModel` so finished matches with equal `setsWon` render `summary.tiedGame` and non-tie matches render existing winner keys; keep set history rendering unchanged so the newly appended partial set appears naturally.
6. Update `tests/game-screen-layout.test.js` with exact assertions and harness support: add `hmUI.showToast` capture, add controllable `setTimeout/clearTimeout` injection in scenario runner, update existing fixed counts from 5 to 6 controls and image-button count from 1 to 2, assert icon order/defaults (`home-icon.png`, `coach-icon.png`), assert first tap switches to `whistle-icon.png` and emits one toast, assert second tap within window sets runtime status finished + navigates to `page/summary` + appends one final partial set snapshot, assert timeout callback reverts icon to coach without finishing, assert timer clear is called on destroy/navigation.
7. Update `tests/summary-screen.test.js` with exact assertions: tie case (`setsWon.teamA === setsWon.teamB`) shows `summary.tiedGame` and not winner keys, non-tie case shows the correct winner key from `setsWon` (including mismatch metadata guard), and SCROLL_LIST `data_array` contains completed sets plus final partial snapshot line (e.g., `Set 3: 4-3`) with expected `data_count`.
8. Run validation gates: targeted tests first (`node --test tests/game-screen-layout.test.js tests/summary-screen.test.js`) then full QA (`npm run complete-check`), and confirm no behavior drift for automatic scoring-based completion by rerunning existing completion tests in `tests/game-screen-layout.test.js`.

## Validation
- Success criteria: Game footer renders two icons with correct default/confirm states; 3-second two-tap confirmation behavior is deterministic and cleaned up safely; manual finish persists `status: finished` and includes one final partial set snapshot; summary renders tie message for equal sets and winner message for non-tie based on `setsWon`; no resumable active game appears after manual finish because persisted session is finished; `tests/game-screen-layout.test.js`, `tests/summary-screen.test.js`, and `npm run complete-check` pass.
- Checkpoints: Pre-implementation assumptions check (assets `coach-icon.png`/`whistle-icon.png` exist for gtr-3 and gts-3; home button order dependencies in tests are cataloged; summary currently resolves winner using metadata fallback); during-implementation correctness checks (first tap: whistle + toast + timer id captured; second tap: timer cleared + finish transition once; timeout path: icon reset only; snapshot dedupe verified by set number; tie winner metadata cleared); post-implementation verification/regression checks (auto-finish via scoring unchanged, gesture/home navigation unchanged, summary/history lines include final partial snapshot); risk/edge-case checklist (double-trigger race, already-finished no-op, missing/malformed currentSetStatus fallback, timer callback firing after destroy, metadata mismatch vs setsWon); rollback/mitigation note for elevated risk (if manual-finish snapshot logic corrupts setHistory ordering, revert to clone-only + append-on-missing strategy and gate with failing tests before re-enabling metadata adjustments).